##服务端推送的解决方案

###瓶颈：

1. 锁：
	>频繁的上下线,造成大量的读写操作，容易造成大量锁互相等待

2. CPU：
	>上千万的推送需要大量的json操作浪费大量计算力

3. 系统:
	>linux系统在处理TCP网络系统调用的时候，大概每秒只能处理100万左右个包

4. 单机性能瓶颈

###解决方案
1. 锁，
	>将socket链接打散到不同的map，如同数据库的分表
2. CPU
	>将推送的JSON提前编译好，一场比赛100万用户的推送也只需要编译一次
3. 系统
	>将同个赛事的不同信息进行合并，10条信息只推送一个
4. 单机性能
	>集群化处理

###技术选型

- Nodejs,  python，php等性能太低
- Java的多线程只能有数千个无法满足
- C/C++库少，开发难度大，适用网页端的websocket需要自己造封装

- 最后选择go
	编译语言，性能好
	协程性能优异，单机可达千万以上
	完整的websocket库

### 架构设计方案
1. master – node架构
 - 1台master，像node节点进行分发的动作

 - 但如果需要分发用户发送的消息的情况下master难以做横向扩展

2. 分层架构
	- 连接层
	- Api调用以及分发层
	- 业务层

>连接层专门负责管理与用户的socket链接
分发层负责接收信息以及像连接层广播消息
业务层

###适用
1. 弹幕
2. 文字直播
3. 反馈消息